<html>
    <head>
        <title>busfarhn</title>
        
        <meta name="keywords" content="windows 8, modern style, modern ui, style, modern, css, framework">

        <script src="/js/jquery.js"></script>
        <script src="/knob/jquery.knob.js"></script>
        <script src="/socket.io/socket.io.js"></script>

        <link href="/metro/css/modern.css" rel="stylesheet">
        <link href="/metro/css/theme-dark.css" rel="stylesheet">
        <link href="/metro/css/modern-responsive.css" rel="stylesheet">
        
        <script>
            var socket = io.connect();
        </script>
    </head>
    <body class="modern-ui">
        <div class="page-region">
        {{#each config}}
             <div class="tile-group">
                <h3>{{label}}</h3>
                {{#each widgets}}
                    {{#type 'action'}}
                    <div id="action{{id}}" class="tile">
                        <div class="tile-content">
                            <h4>{{this.label}}</h4>
                            {{this.desc}}
                        </div>
                        <div class="brand">
                            <div class="badge"></div>
                            <div class="name">{{this.type}}</div>
                        </div>
                    </div>
                    <script>$(function() { $("#action{{this.id}}").click(function(value) {
                        socket.emit('action{{this.id}}', "");
                    }); })</script>
                    {{/type}}
                    
                    {{#type 'range'}}
                    <div class="tile bg-color-orange">
                        <div class="tile-content">
                            <h4>{{this.label}}</h4>
                            {{this.desc}}
                            <input id="knob{{this.id}}" data-width="100" data-min="{{this.range.from}}" data-displayPrevious="true" data-max="{{this.range.to}}" data-fgColor="#222222" data-thickness=".5" />
                            <script>
                                $(function() { $("#knob{{this.id}}").knob({
                                    release: function(value) {
                                        var marshal = {{{this.message.marshal}}};
                                        socket.emit('rangeUpdate{{this.id}}', marshal(value));
                                    }
                                }); });
                                
                                socket.on('rangeUpdateView{{id}}', function (data) {
                                    var unmarshal = {{{this.message.unmarshal}}};
                                    $('#knob{{id}}').val(unmarshal(data.type, data.time, data.msg)).trigger('change');
                                });
                            </script>
                        </div>
                    </div>
                    {{/type}}
                    
                    {{#type 'display'}}
                    <div class="tile bg-color-blue">
                        <div class="tile-content">
                            <h4>{{this.label}}</h4>
                            {{this.desc}}<span id="display{{id}}">&nbsp;</span>
                            
                            <script>
                                socket.on('display{{id}}', function (data) {
                                    var unmarshal = {{{message.unmarshal}}};
                                    $('#display{{id}}').html(unmarshal(data.type, data.time, data.msg));
                                });
                            </script>
                        </div>
                    </div>
                    {{/type}}
                {{/each}}
            </div>
        {{/each}}
        </div>
    </body>
</html>
